<%
/**
 *
 * @collections.suppliers
 * @model
 * @storeId
 */
%>

<% var config = require('config') %>

<% var partials = {
    select_suppliers: require('ejs!blocks/select/select_suppliers/template.ejs'),
    totalSum: require('ejs!blocks/form/form_order/form_order__totalSum.ejs'),
    table_orderProducts: require('ejs!blocks/table/table_orderProducts/template.ejs')
} %>

<form class="form form_order <%- model.id ? '' : 'form_changed' %>" style="margin-bottom: 20px;">
    <div class="form__field" style="padding-bottom: 30px;">
        <label class="form__label">Поставщик</label>
        <%= partials.select_suppliers({
            collections: _.pick(collections, 'suppliers'),
            selected: model.get('supplier.id')
        }) %>
    </div>
    <div style="margin-bottom: 30px;">
        <%= model.collections.products.element(partials.table_orderProducts, {
            collections: {
                orderProducts: model.collections.products
            }
        }) %>
    </div>

    <h2>Добавление товара в заказ</h2>

    <div class="form__field" style="padding-bottom: 30px;">
        <input placeholder="Для добавления позиции введите наименование товара или код"
               style="width: 600px;"
               data-url="<%- config.baseApiUrl + '/stores/' + storeId + '/search/products?properties[]=name&properties[]=sku&purchasePriceNotEmpty=1' %>"
               type="text" class="inputText autocomplete"/>
    </div>

    <div class="form__totalSum">
        Итого:
        <%= model.collections.products.element(partials.totalSum, {
            collections: {
                orderProducts: model.collections.products
            }
        }) %>
    </div>

    <% if(null == model.get('invoice')) { %>
        <div class="form__controls">
            <div class="form_order__invoiceControls">
                <a href="<%= model.getCreateInvoiceFromOrderUrl() %>" class="button">
                    Принять по заказу
                </a>
            </div>
            <div class="form_order__saveControls">
                <% if (model.id){ %>
                <p>Заказ изменён, подтвердите изменения, пожалуйста.</p>
                <% } %>
                <button type="submit" class="button">
                    Сохранить
                </button>
            <span style="margin-right: 10px;">
            или
            </span>
                <a style="margin-right: 20px;" href="/orders">
                    Отменить
                </a>
            </div>
        </div>
    <% } %>
</form>