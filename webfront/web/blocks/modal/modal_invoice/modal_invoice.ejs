<% var InvoiceModel = require('models/invoice/invoice') %>
<% var invoiceModel = invoiceModel || new InvoiceModel() %>
<% var partials = {
    form_supplier: require('ejs!blocks/form/form_supplier/template.ejs'),
    invoiceProducts: require('ejs!blocks/form/form_invoiceProducts/invoiceProducts.ejs')
} %>
<% var helpers = {
    formatMoney: require('kit/formatMoney/formatMoney'),
    formatAmount: require('kit/formatAmount/formatAmount'),
    formatDate: require('kit/formatDate/formatDate')
} %>

<div id="<%- invoiceModel.id ? 'modal_invoiceEdit' : 'modal_invoiceAdd' %>"
     tabindex="-1"
     role="dialog"
     aria-labelledby="modal-default-label"
     aria-hidden="true"
     class="modal modal_invoice fade"
     style="display: none;">
    <div class="modal__dialog_visible modal__dialog_invoice modal-dialog modal-wide-width">
        <div class="modal-content">
            <div class="modal-header">
                <a type="button"
                   data-dismiss="modal"
                   aria-hidden="true"
                   class="close pull-left fa fa-times"></a>

                <button form="<%- invoiceModel.id ? 'form_invoiceEdit' : 'form_invoiceAdd' %>"
                        type="submit"
                        class="btn btn-primary pull-right">
                    <%- invoiceModel.id ? 'Сохранить' : 'Принять' %>
                </button>

                <h4 class="modal-title">
                    <%- invoiceModel.id ? 'Редактирование приёски товаров от поставщика' : 'Приёмка товаров от поставщика' %>
                </h4>

                <span class="clearfix"></span>
            </div>
            <div class="modal-body">
                <form id="<%- invoiceModel.id ? 'form_invoiceEdit' : 'form_invoiceAdd' %>" class="form form_invoice">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">

                                <label class="control-label">Дата *</label>

                                <div class="datetimepicker-default date">
                                    <input name="date"
                                           type="text"
                                           class="form-control datepicker-default inputDate"
                                           value="<%- invoiceModel.get('date') ? helpers.formatDate(invoiceModel.get('date')) : '' %>">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">

                                <label class="control-label">Магазин *</label>

                                <div class="input-icon right">
                                    <select class="form-control" name="store">
                                        <option value="" selected disabled>Выберите магазин</option>
                                        <% collections.stores.forEach(function(storeModel){ %>
                                        <option <%- invoiceModel.get('store.id') === storeModel.id ? 'selected' : '' %>
                                                value="<%- storeModel.id %>"><%- storeModel.get('name') %>
                                        </option>
                                        <% }) %>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">

                                <label class="control-label">Поставщик</label>

                                <div class="row">
                                    <div class="col-md-10">
                                        <select class="form-control" name="supplier">
                                            <option value="" selected disabled>Выберите поставщика</option>
                                            <% collections.suppliers.forEach(function(supplierModel){ %>
                                            <option <%- invoiceModel.get('supplier.id') === supplierModel.id ? 'selected' : '' %>
                                                    value="<%- supplierModel.id %>"><%- supplierModel.get('name') %>
                                            </option>
                                            <% }) %>
                                        </select>
                                    </div>

                                    <div class="col-md-2">
                                        <a style="font-size: 20px; position: relative; top: 10px; left: -10px; cursor: pointer;"
                                           class="addSupplierLink fa fa-plus"></a>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="checkbox">
                            <input tabindex="5"
                                   type="checkbox"
                                   name="paid"
                                   value="true" <%- invoiceModel.get('paid') ? 'checked' : '' %>/>
                            <span class="checkbox__text">
                                Оплачено
                            </span>
                        </label>
                    </div>
                </form>

                <hr style="margin: 0 -65px;"/>
                <h3>Товары</h3>

                <form class="form_invoiceProducts">
                    <table class="table_invoiceProducts table table-vcenter" style="margin: 0 -10px;">
                        <thead>
                        <tr>
                            <th>Наименование</th>
                            <th style="white-space: nowrap; width: 1px;">Цена, <i class="fa fa-rub"></i></th>
                            <th style="width: 1px;">Кол-во</th>
                            <th style="white-space: nowrap; width: 1px;">Сумма, <i class="fa fa-rub"></i></th>
                            <th style="width: 1px;"></th>
                        </tr>
                        </thead>
                        <tbody>

                            <%= partials.invoiceProducts() %>

                        </tbody>
                        <tfoot>

                        <tr class="invoiceProductForm">
                            <td>
                                <input name="product.name"
                                       type="text"
                                       class="form-control autocomplete autocomplete_products">
                                <input type="hidden" name="product.id" />
                            </td>
                            <td>
                                <input name="priceEntered"
                                       type="text"
                                       style="width: 100px;"
                                       class="form-control">
                            </td>
                            <td>
                                <div style="white-space: nowrap">
                                    <input name="quantity"
                                           type="text"
                                           style="width: 80px; display: inline-block;"
                                           class="form-control">
                                    <span style="position: relative; padding: 0 5px;" class="product__units">шт.</span>
                                </div>
                            </td>
                            <td>
                                <span style="white-space: nowrap; min-width: 100px; position: relative; top: 7px;" class="totalSum"></span>
                            </td>
                            <td>
                                <button type="submit"
                                   style="margin-top: 0;"
                                   class="addInvoiceProduct btn btn-default fa fa-check btn-lg"></button>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                    <div class="form__errorMessage form__errorMessage_global"></div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-dialog modal__dialog_supplier modal__dialog_hidden">
        <div class="modal-content">
            <div class="modal-header">
                <a class="modal__backLink invoiceModalLink fa fa-long-arrow-left" style="font-size: 25px; margin-right: 10px;"></a>

                <button form="form_supplierAdd"
                        type="submit"
                        class="btn btn-primary pull-right">
                    Добавить
                </button>

                <h4 class="modal-title">
                    Добавление поставщика
                </h4>

                <span class="clearfix"></span>
            </div>
            <div class="modal-body">

                <%= partials.form_supplier() %>

            </div>
        </div>
    </div>

</div>